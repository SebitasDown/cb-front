import{p as h}from"./main-BYO-dcHG.js";const v="https://cb-back-prueba.vercel.app",u=`${v}/chat`;function E(){console.log("🚀 Inicializando chat...");const a=document.getElementById("messages"),l=document.getElementById("input"),r=document.getElementById("send-btn"),p=document.getElementById("form");if(console.log("🔍 Elementos del chat encontrados:",{messagesContainer:!!a,input:!!l,sendBtn:!!r,form:!!p}),!a||!l||!r){console.warn("❌ Chat elements not found");return}function d(){a.innerHTML="",c("¡Hola! Soy tu asistente de IA especializado en desarrollo de software. ¿En qué puedo ayudarte con este video?","bot"),setTimeout(()=>i(),200)}function g(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function y(t){let e=t;return e=e.replace(/```(\w+)?\n([\s\S]*?)```/g,(o,n,s)=>`<div class="code-block">
        <div class="code-header">
          <span class="code-language">${n||"text"}</span>
          <button class="copy-btn" onclick="copyCode(this)">📋</button>
        </div>
        <pre class="code-content"><code>${g(s.trim())}</code></pre>
      </div>`),e=e.replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>'),e=e.replace(/^\d+\.\s+(.+)$/gm,"<li>$1</li>"),e.includes("<li>")&&!e.includes("<ol")&&(e=e.replace(/(<li>.*<\/li>)/s,'<ol class="numbered-list">$1</ol>')),e=e.replace(/^[-*]\s+(.+)$/gm,"<li>$1</li>"),e.includes("<li>")&&!e.includes("<ol")&&(e=e.replace(/(<li>.*<\/li>)/s,'<ul class="bullet-list">$1</ul>')),e=e.replace(/^#{1,3}\s+(.+)$/gm,(o,n)=>{const s=o.match(/^#+/)[0].length;return`<h${Math.min(s,6)} class="message-title">${n}</h${Math.min(s,6)}>`}),e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.+?)\*/g,"<em>$1</em>"),e=e.replace(/\n/g,"<br>"),e}function i(){setTimeout(()=>{a.scrollTo({top:a.scrollHeight,behavior:"smooth"})},100)}function c(t,e){const o=document.createElement("div");o.className=e==="user"?"user-msg":"bot-msg",e==="bot"?o.innerHTML=y(t):o.textContent=t;const n=document.createElement("small");n.className="message-time",n.textContent=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),n.style.display="block",n.style.fontSize="0.75rem",n.style.opacity="0.7",n.style.marginTop="0.25rem",o.appendChild(n),a.appendChild(o),i(),o.style.opacity="0",o.style.transform="translateY(10px)",o.style.transition="all 0.3s ease",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0)"},100)}async function m(){const t=l.value.trim();if(!t)return;console.log("📤 Enviando mensaje:",t),c(t,"user"),l.value="";const e=document.createElement("div");e.className="bot-msg typing-indicator",e.innerHTML=`
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    `,a.appendChild(e),i();try{console.log("🌐 Enviando a:",u);const o=JSON.parse(localStorage.getItem("currentVideo"))||{},n=o.id_video||1;console.log("🎥 Video ID:",n),console.log("🎬 Video actual:",o);const s=await h(u,{ask:t,videoID:n});console.log("✅ Respuesta del backend:",s),a.removeChild(e),s&&s.responses?c(s.responses,"bot"):s&&s.message?c(s.message,"bot"):c("Lo siento, no pude procesar tu mensaje. Inténtalo de nuevo.","bot")}catch(o){console.error("❌ Error sending message:",o),a.removeChild(e),c("Lo siento, hubo un error al procesar tu mensaje. Inténtalo de nuevo.","bot")}}r.addEventListener("click",m),l.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),m())}),l.focus(),c("¡Hola! Soy tu asistente de IA especializado en desarrollo de software. ¿En qué puedo ayudarte con este video?","bot"),i(),window.addEventListener("storage",t=>{t.key==="currentVideo"&&(console.log("🎬 Video cambiado, limpiando chat..."),d())});const f=localStorage.setItem;localStorage.setItem=function(t,e){t==="currentVideo"&&(console.log("🎬 Video cambiado desde el mismo tab, limpiando chat..."),setTimeout(()=>d(),100)),f.apply(this,arguments)},window.copyCode=function(t){const n=t.closest(".code-block").querySelector(".code-content code").textContent;navigator.clipboard.writeText(n).then(()=>{const s=t.textContent;t.textContent="✅",t.style.background="#28a745",setTimeout(()=>{t.textContent=s,t.style.background=""},2e3)}).catch(s=>{console.error("Error copiando código:",s),t.textContent="❌",t.style.background="#dc3545",setTimeout(()=>{t.textContent="📋",t.style.background=""},2e3)})},console.log("✅ Chat inicializado correctamente")}export{E as initChat};
