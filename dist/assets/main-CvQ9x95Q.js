(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const V="modulepreload",N=function(e,t){return new URL(e,t).href},B={},C=function(t,o,i){let n=Promise.resolve();if(o&&o.length>0){let g=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const r=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");n=g(o.map(d=>{if(d=N(d,i),d in B)return;B[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(!!i)for(let a=r.length-1;a>=0;a--){const u=r[a];if(u.href===d&&(!h||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":V,h||(v.as="script"),v.crossOrigin="",v.href=d,c&&v.setAttribute("nonce",c),document.head.appendChild(v),h)return new Promise((a,u)=>{v.addEventListener("load",a),v.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return n.then(r=>{for(const l of r||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})},$={"/":"./views/login.html","/login":"./views/login.html","/home":"./views/home.html","/uploadVideos":"./views/videos.html","/videos":"./views/videoplayer.html","/workshop":"./views/workshop.html"};async function L(e){try{return await(await fetch(e)).json()}catch(t){console.error("Error en GET:",t)}}async function R(e,t){try{return await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}catch(o){console.error("Error en POST:",o)}}async function Z(e,t){try{const i=await(await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return console.log("PUT actualizado:",i),i}catch(o){throw console.error("Error en PUT:",o),o}}async function ee(e){try{return(await fetch(e,{method:"DELETE"})).ok?(console.log("DELETE: recurso eliminado correctamente"),!0):(console.error("Error al eliminar"),!1)}catch(t){throw console.error("Error en DELETE:",t),t}}const A="https://cb-back-prueba.vercel.app/auth";function U(){const e=document.getElementById("login-form"),t=document.getElementById("logout-btn"),o=JSON.parse(localStorage.getItem("user"));o&&(console.log(`Active session: ${o.email}`),f("/home")),e&&e.addEventListener("submit",async i=>{i.preventDefault();const n=document.getElementById("email").value,s=document.getElementById("password").value;try{const r=await R(A,{email:n,user_password:s});r.user?(localStorage.setItem("user",JSON.stringify(r.user)),console.log(`Login successful. Welcome, ${r.user.email}`),f("/home")):console.log(`Login failed: ${r.message||"Invalid credentials"}`)}catch(r){console.error("Error during login:",r)}}),t&&t.addEventListener("click",()=>{localStorage.removeItem("user"),console.log("Session closed."),f("/login")})}const H="https://cb-back-prueba.vercel.app/search",D="https://cb-back-prueba.vercel.app/videos";async function j(){try{const e=await L(D);if(!Array.isArray(e))return;const o=e.sort((r,l)=>new Date(l.video_date)-new Date(r.video_date)).slice(0,3),i=document.getElementById("recentWorkshopsGrid");if(!i)return;const n=["linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-pink) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-green) 0%, var(--color-yellow) 100%)","linear-gradient(135deg, var(--color-yellow) 0%, var(--color-orange) 100%)","linear-gradient(135deg, var(--color-orange) 0%, var(--color-primary) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-yellow) 100%)"],s=o.map((r,l)=>r?.url?`
          <div class="col-12 col-sm-6 col-md-4">
            <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
              <div class="position-relative">
                <div class="ratio ratio-16x9" style="background: ${n[l%n.length]}; cursor: pointer; position: relative;"
                  onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${r.id_video||1}, title: '${r.title?.replace(/'/g,"\\'")}', url: '${r.url?.replace(/'/g,"\\'")}' }));">
                  <div class="play-button-container">
                    <i class="bi bi-play-circle-fill"></i>
                  </div>
                </div>
                <span class="position-absolute top-0 start-0 m-2 badge bg-success">üÜï</span>
              </div>
              <div class="card-body p-3">
                <h6 class="card-title fw-bold mb-1 text-truncate" title="${r.title}">üé¨ ${r.title}</h6>
                <p class="card-text small text-muted mb-0 text-truncate" title="${r.summary||""}">${r.summary||""}</p>
              </div>
            </div>
          </div>
        `:"").join("");i.innerHTML=s}catch(e){console.error("Error loading recent workshops:",e)}}function z(){const e=document.getElementById("searchbtn"),t=document.getElementById("searchInput"),o=document.getElementById("searchResults"),i=document.querySelector(".view-container");j();function n(r){if(!i)return;Array.from(i.children).forEach(c=>{const g=c.classList?.contains("welcome-section"),d=c.id==="searchResults";g||d||(c.style.display=r?"":"none")})}async function s(r){r.preventDefault();const c=document.getElementById("searchInput").value.trim();if(!c){n(!0),o&&(o.innerHTML="");return}try{n(!1);const g=await L(`${H}?q=${encodeURIComponent(c)}`);if(!Array.isArray(g)||g.length===0){o.innerHTML=`<div class="p-2">No se encontraron resultados para "${c}"</div>`;return}const d=["linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-pink) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-green) 0%, var(--color-yellow) 100%)","linear-gradient(135deg, var(--color-yellow) 0%, var(--color-orange) 100%)","linear-gradient(135deg, var(--color-orange) 0%, var(--color-primary) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-yellow) 100%)"],h=Array.isArray(g)?g.map((m,b)=>m?.url?`
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                  <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
                    <div class="position-relative">
                      <div class="ratio ratio-16x9" style="background: ${d[b%d.length]}; cursor: pointer; position: relative;"
                        onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${m.id_video||1}, title: '${m.title?.replace(/'/g,"\\'")}', url: '${m.url?.replace(/'/g,"\\'")}' }));">
                        <div class="play-button-container">
                          <i class="bi bi-play-circle-fill"></i>
                        </div>
                      </div>
                      <span class="position-absolute top-0 start-0 m-2 badge bg-primary">‚ñ∂Ô∏è</span>
                    </div>
                    <div class="card-body p-3">
                      <h6 class="card-title fw-bold mb-1 text-truncate" title="${m.title}">üé¨ ${m.title}</h6>
                      <p class="card-text small text-muted mb-0 text-truncate" title="${m.summary||""}">${m.summary||""}</p>
                    </div>
                  </div>
                </div>
              `:"").join(""):"";o.innerHTML=h?`<div class="row g-3">${h}</div>`:`<div class="p-2">No se encontraron resultados para "${c}"</div>`}catch(g){console.error("Error fetching search results:",g)}}e.addEventListener("click",s),t.addEventListener("keypress",r=>{r.key==="Enter"&&s(r)})}const W="https://cb-back-prueba.vercel.app/videos",q="https://cb-back-prueba.vercel.app/categories";let x=[],E=[],T=null;function O(e){const t=document.getElementById("workshopVideosGrid");if(!t)return;const o=["linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-pink) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-green) 0%, var(--color-yellow) 100%)","linear-gradient(135deg, var(--color-yellow) 0%, var(--color-orange) 100%)","linear-gradient(135deg, var(--color-orange) 0%, var(--color-primary) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-yellow) 100%)"],i=(e||[]).map((n,s)=>{const r=(n.title||"Video").replace(/'/g,"\\'"),l=(n.url||"").replace(/'/g,"\\'");return`
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
            <div class="position-relative">
              <div class="ratio ratio-16x9" style="background: ${o[s%o.length]}; cursor: pointer; position: relative;"
                onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${n.id_video}, title: '${r}', url: '${l}' }));">
                <div class="play-button-container">
                  <i class="bi bi-play-circle-fill"></i>
                </div>
              </div>
              <!-- Bot√≥n de eliminar -->
              <button class="btn btn-delete-video" onclick="deleteVideo(${n.id_video}, this)" title="Eliminar video">
                <i class="bi bi-trash-fill"></i>
              </button>
            </div>
            <div class="card-body p-3">
              <h6 class="card-title fw-bold mb-0 text-truncate" title="${n.title}">üé¨ ${n.title}</h6>
            </div>
          </div>
        </div>
      `}).join("");t.innerHTML=i||'<div class="text-muted">No hay videos para mostrar.</div>'}function J(e){const t=x.find(i=>(i.category_name||"").toLowerCase()===(e||"").toLowerCase());T=t?t.id_category:null;const o=T?E.filter(i=>i.id_category===T):E;O(o)}window.deleteVideo=async function(e,t){if(confirm("¬øEst√°s seguro de que quieres eliminar este video?"))try{if((await fetch(`https://cb-back-prueba.vercel.app/videos/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok){E=E.filter(n=>n.id_video!==e);const i=t.closest(".col-12");i&&i.remove(),P("Video eliminado correctamente","success")}else throw new Error("Error al eliminar el video")}catch(o){console.error("Error eliminando video:",o),P("Error al eliminar el video","error")}};function P(e,t="info"){const o=document.createElement("div");o.className=`alert alert-${t==="success"?"success":"danger"} position-fixed`,o.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",o.innerHTML=e,document.body.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},3e3)}async function F(){console.log("üèãÔ∏è Workshop.js cargado correctamente.");try{const[e,t]=await Promise.all([L(q),L(W)]);Array.isArray(e)?x=e:x=[],Array.isArray(t)?E=t:E=[],O(E)}catch(e){console.error("Error cargando categor√≠as/videos:",e)}document.addEventListener("click",e=>{const t=e.target.closest(".category-chip");if(!t)return;const o=t.getAttribute("data-category")||t.textContent?.trim();o&&(document.querySelectorAll(".category-chip.active").forEach(i=>i.classList.remove("active")),t.classList.add("active"),J(o))},{passive:!0})}function G(){try{const e=localStorage.getItem("currentVideo"),t=e?JSON.parse(e):null,o=document.querySelector(".video-placeholder"),i=document.getElementById("videoTitle");if(!o||!i){console.warn("Elementos del reproductor no encontrados.");return}if(!t?.url)return;const n=document.createElement("video");n.src=t.url,n.controls=!0,n.className="w-100",n.style.borderRadius="0",n.style.display="block",n.addEventListener("loadedmetadata",function(){const r=n.videoWidth,l=n.videoHeight,c=800,g=r/l;let d=r;if(d>c&&(d=c),Math.abs(d-720)>50){const m=document.querySelector(".video-container"),b=document.querySelector(".video-info-container"),v=document.querySelector(".comments-section");m&&(m.style.width=d+"px"),b&&(b.style.width=d+"px"),v&&(v.style.width=d+"px")}});const s=o.parentNode;s?s.replaceChild(n,o):(o.className="",o.style.cssText="",o.innerHTML="",o.appendChild(n)),i.textContent=t.title||"Video seleccionado"}catch(e){console.error("Error inicializando el reproductor:",e)}}const I="https://cb-back-prueba.vercel.app";function _(){const e=document.getElementById("uploadPanel"),t=document.getElementById("uploadVideoForm"),o=document.getElementById("category"),i=document.getElementById("user"),n=document.getElementById("closeUploadPanel"),s=document.getElementById("videoFile"),r=document.getElementById("thumbnailPreviewSection"),l=document.getElementById("thumbnailPreview"),c=document.getElementById("submitBtn"),g=document.getElementById("submitBtnText");if(!e||!t)return;e.classList.remove("show"),console.log("üîÑ Inicializando panel de upload con preview de miniatura..."),b(),v();function d(a){if(!a||!a.type.startsWith("video/")){r.style.display="none";return}const u=URL.createObjectURL(a),p=document.createElement("video");p.muted=!0,p.crossOrigin="anonymous",p.addEventListener("loadedmetadata",function(){const y=this.duration*.25;this.currentTime=y}),p.addEventListener("seeked",function(){const y=document.createElement("canvas"),k=y.getContext("2d");y.width=this.videoWidth,y.height=this.videoHeight,k.drawImage(this,0,0,y.width,y.height);const w=y.toDataURL("image/jpeg",.8);l.innerHTML=`
        <img src="${w}" alt="Video Thumbnail Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
        <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem;">
          ${Math.round(this.duration)}s
        </div>
      `,r.style.display="block",URL.revokeObjectURL(u)}),p.addEventListener("error",function(){console.error("Error al cargar video para preview"),r.style.display="none"}),p.src=u}s.addEventListener("change",a=>{const u=a.target.files[0];u?(console.log("üé¨ Archivo de video seleccionado:",u.name),d(u)):r.style.display="none"});function h(){e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show")}n?.addEventListener("click",()=>{e.classList.remove("show"),t.reset(),r.style.display="none",l.innerHTML=`
      <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
      <span class="text-muted">Preview will appear here</span>
    `}),document.addEventListener("click",a=>{e.classList.contains("show")&&!e.contains(a.target)&&!a.target.closest("#buttonupload")&&(e.classList.remove("show"),t.reset(),r.style.display="none",l.innerHTML=`
        <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
        <span class="text-muted">Preview will appear here</span>
      `)});const m=document.getElementById("buttonupload");m&&m.addEventListener("click",a=>{a.preventDefault(),console.log("üîò Bot√≥n de upload clickeado"),h()}),t.addEventListener("submit",async a=>{a.preventDefault();try{c.disabled=!0,c.classList.add("loading"),g.textContent="‚è≥ Processing...";const u=document.getElementById("videoFile"),p=document.getElementById("title"),y=i?.value,k=o?.value;if(console.log("üìù Valores del formulario:",{userId:y,categoryId:k,title:p.value}),!y||!k){alert("Please select both a category and a speaker");return}const w=new FormData;w.append("file",u.files[0]),w.append("title",p.value),w.append("id_user",y),w.append("id_category",k),console.log("üöÄ Enviando video al backend...");const S=await fetch(`${I}/videos/create`,{method:"POST",body:w});if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const M=await S.json();console.log("‚úÖ Respuesta del backend:",M),e.classList.add("success"),g.textContent="‚úÖ Upload Complete!",setTimeout(()=>{t.reset(),e.classList.remove("show","success"),r.style.display="none",l.innerHTML=`
          <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
          <span class="text-muted">Preview will appear here</span>
        `,c.disabled=!1,c.classList.remove("loading"),g.textContent="Upload Video"},2e3)}catch(u){console.error("‚ùå Error durante el upload:",u),c.disabled=!1,c.classList.remove("loading"),g.textContent="Upload Video",alert("Error uploading video. Please try again.")}});async function b(){try{console.log("üîÑ Cargando categor√≠as desde:",`${I}/categories`);const a=await L(`${I}/categories`);if(console.log("üìä Categor√≠as recibidas:",a),!o){console.error("‚ùå Elemento selectCategory no encontrado");return}o.innerHTML='<option value="">Select a category...</option>',Array.isArray(a)?(a.forEach(u=>{const p=document.createElement("option");p.value=u.id_category,p.textContent=u.category_name,o.appendChild(p)}),console.log("‚úÖ Select de categor√≠as poblado con",a.length,"opciones")):console.error("‚ùå Las categor√≠as no son un array:",a)}catch(a){console.error("‚ùå Error cargando categor√≠as:",a)}}async function v(){try{const a=await L(`${I}/speakers`);i.innerHTML='<option value="">Choose a speaker...</option>',a.forEach(u=>{const p=document.createElement("option");p.value=u.id_user,p.textContent=u.nickname,i.appendChild(p)}),console.log("‚úÖ Speakers cargados:",a.length)}catch(a){console.error("‚ùå Error cargando speakers:",a),i.innerHTML='<option value="">Error loading speakers</option>'}}console.log("‚úÖ Sistema de upload con preview de miniatura inicializado completamente")}document.addEventListener("DOMContentLoaded",()=>{console.log("üöÄ DOM cargado, inicializando upload..."),_()});const K=["/home","/videos","/workshop"];async function f(e){console.log("Router: navigate() called with path:",e);const t=document.getElementById("app-content"),o=$[e]||$["/"];try{const i=JSON.parse(localStorage.getItem("user"));if(K.includes(e)&&!i)return console.warn("Access denied. Redirecting to /login..."),f("/login");window.location.pathname!==e&&window.history.pushState({},"",e);const n=await fetch(o);if(!n.ok)throw new Error(`Could not load page: ${o}`);const s=await n.text();t.innerHTML=s,Q(e),X(e),console.log(`Navigation completed: ${e}`)}catch(i){console.error("Navigation error:",i),t.innerHTML=`<h1>Error</h1><p>${i.message}</p>`}}function Q(e){const t=document.getElementById("sidebar"),o=document.getElementById("main-content"),i=document.getElementById("app-content");e==="/"||e==="/login"?(t?.classList.add("hidden"),o?.classList.add("full-width"),i?.classList.add("login-fullscreen")):(t?.classList.remove("hidden"),o?.classList.remove("full-width"),i?.classList.remove("login-fullscreen"))}function X(e){switch(e){case"/":case"/login":console.log("Initializing LoginUser..."),U();break;case"/home":console.log("Initializing Home..."),z();break;case"/uploadVideos":console.log("Initializing Home..."),_();break;case"/videos":console.log("Initializing Videos..."),setTimeout(()=>{G(),C(()=>import("./main-DKaXINnG.js"),[],import.meta.url).then(t=>{t.initComments()}),C(()=>import("./chat-DJJSOhm0.js"),[],import.meta.url).then(t=>{t.initChat()})},100);break;case"/workshop":console.log("Initializing Workshop..."),setTimeout(()=>F(),0);break;default:console.log("No script defined for this route.")}}document.addEventListener("DOMContentLoaded",async()=>{const e=JSON.parse(localStorage.getItem("user")),t=window.location.pathname;if((t==="/"||t==="/login")&&e)return console.log("User detected, redirecting to /home"),f("/home");f(t)});window.addEventListener("popstate",()=>{f(window.location.pathname)});window.navigateTo=f;function Y(){const e=document.getElementById("mobileMenuBtn"),t=document.getElementById("sidebar"),o=document.getElementById("sidebarOverlay"),i=document.querySelector(".hamburger");if(!e||!t||!o||!i){console.warn("Mobile menu elements not found");return}function n(){t.classList.contains("mobile-open")?r():s()}function s(){t.classList.add("mobile-open"),o.classList.add("active"),i.classList.add("active"),document.body.style.overflow="hidden"}function r(){t.classList.remove("mobile-open"),o.classList.remove("active"),i.classList.remove("active"),document.body.style.overflow=""}e.addEventListener("click",n),o.addEventListener("click",r),t.querySelectorAll(".nav-item").forEach(c=>{c.addEventListener("click",()=>{setTimeout(r,100)})}),document.addEventListener("keydown",c=>{c.key==="Escape"&&r()}),window.addEventListener("resize",()=>{window.innerWidth>768&&r()}),console.log("üì± Mobile menu initialized")}document.addEventListener("DOMContentLoaded",function(){f("/"),Y()});window.handleUpload=function(){f("/uploadVideos")};export{ee as d,L as g,R as p,Z as u};
