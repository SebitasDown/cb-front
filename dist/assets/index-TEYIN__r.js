(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const V="modulepreload",R=function(e,t){return new URL(e,t).href},B={},$=function(t,o,s){let n=Promise.resolve();if(o&&o.length>0){let g=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const r=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),c=d?.nonce||d?.getAttribute("nonce");n=g(o.map(l=>{if(l=R(l,s),l in B)return;B[l]=!0;const u=l.endsWith(".css"),y=u?'[rel="stylesheet"]':"";if(!!s)for(let a=r.length-1;a>=0;a--){const m=r[a];if(m.href===l&&(!u||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${y}`))return;const v=document.createElement("link");if(v.rel=u?"stylesheet":V,u||(v.as="script"),v.crossOrigin="",v.href=l,c&&v.setAttribute("nonce",c),document.head.appendChild(v),u)return new Promise((a,m)=>{v.addEventListener("load",a),v.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(r){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=r,window.dispatchEvent(d),!d.defaultPrevented)throw r}return n.then(r=>{for(const d of r||[])d.status==="rejected"&&i(d.reason);return t().catch(i)})},C={"/":"./views/login.html","/home":"./views/home.html","/uploadVideos":"./views/videos.html","/videos":"./views/videoplayer.html","/workshop":"./views/workshop.html"};async function w(e){try{return await(await fetch(e)).json()}catch(t){console.error("Error en GET:",t)}}async function U(e,t){try{return await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}catch(o){console.error("Error en POST:",o)}}async function Z(e,t){try{const s=await(await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return console.log("PUT actualizado:",s),s}catch(o){throw console.error("Error en PUT:",o),o}}async function ee(e){try{return(await fetch(e,{method:"DELETE"})).ok?(console.log("DELETE: recurso eliminado correctamente"),!0):(console.error("Error al eliminar"),!1)}catch(t){throw console.error("Error en DELETE:",t),t}}const A="https://cb-back-prueba.vercel.app/auth";function N(){const e=document.getElementById("login-form"),t=document.getElementById("logout-btn"),o=JSON.parse(localStorage.getItem("user"));o&&(console.log(`Active session: ${o.email}`),f("/home")),e&&e.addEventListener("submit",async s=>{s.preventDefault();const n=document.getElementById("email").value,i=document.getElementById("password").value;try{const r=await U(A,{email:n,user_password:i});r.user?(localStorage.setItem("user",JSON.stringify(r.user)),console.log(`Login successful. Welcome, ${r.user.email}`),f("/home")):console.log(`Login failed: ${r.message||"Invalid credentials"}`)}catch(r){console.error("Error during login:",r)}}),t&&t.addEventListener("click",()=>{localStorage.removeItem("user"),console.log("Session closed."),f("/login")})}const H="https://cb-back-prueba.vercel.app/search",D="https://cb-back-prueba.vercel.app/videos";function P(e){return e&&(e.thumbnail||e.poster)?e.thumbnail||e.poster:"assets/images/LogocuadradoCoderBoost.png"}async function j(){try{const e=await w(D);if(!Array.isArray(e))return;const o=e.sort((i,r)=>new Date(r.video_date)-new Date(i.video_date)).slice(0,3),s=document.getElementById("recentWorkshopsGrid");if(!s)return;const n=o.map(i=>i?.url?`
          <div class="col-12 col-sm-6 col-md-4">
            <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
              <div class="position-relative">
                <div class="ratio ratio-16x9">
                  <img src="${P(i)}" loading="lazy" decoding="async" alt="${i.title||"Video"}" 
                    style="border-top-left-radius: 12px; border-top-right-radius: 12px; width: 100%; height: 100%; object-fit: cover; cursor: pointer;"
                    onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${i.id_video||1}, title: '${i.title?.replace(/'/g,"\\'")}', url: '${i.url?.replace(/'/g,"\\'")}' }));" />
                </div>
                <span class="position-absolute top-0 start-0 m-2 badge bg-success">üÜï</span>
              </div>
              <div class="card-body p-3">
                <h6 class="card-title fw-bold mb-1 text-truncate" title="${i.title}">üé¨ ${i.title}</h6>
                <p class="card-text small text-muted mb-0 text-truncate" title="${i.summary||""}">${i.summary||""}</p>
              </div>
            </div>
          </div>
        `:"").join("");s.innerHTML=n}catch(e){console.error("Error loading recent workshops:",e)}}function z(){const e=document.getElementById("searchbtn"),t=document.getElementById("searchInput"),o=document.getElementById("searchResults"),s=document.querySelector(".view-container");j();function n(r){if(!s)return;Array.from(s.children).forEach(c=>{const g=c.classList?.contains("welcome-section"),l=c.id==="searchResults";g||l||(c.style.display=r?"":"none")})}async function i(r){r.preventDefault();const c=document.getElementById("searchInput").value.trim();if(!c){n(!0),o&&(o.innerHTML="");return}try{n(!1);const g=await w(`${H}?q=${encodeURIComponent(c)}`);if(!Array.isArray(g)||g.length===0){o.innerHTML=`<div class="p-2">No se encontraron resultados para "${c}"</div>`;return}const l=Array.isArray(g)?g.map(u=>u?.url?`
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                  <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
                    <div class="position-relative">
                      <div class="ratio ratio-16x9">
                        <img src="${P(u)}" loading="lazy" decoding="async" alt="${u.title||"Video"}"
                          style="border-top-left-radius: 12px; border-top-right-radius: 12px; width: 100%; height: 100%; object-fit: cover; cursor: pointer;"
                          onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${u.id_video||1}, title: '${u.title?.replace(/'/g,"\\'")}', url: '${u.url?.replace(/'/g,"\\'")}' }));" />
                      </div>
                      <span class="position-absolute top-0 start-0 m-2 badge bg-primary">‚ñ∂Ô∏è</span>
                    </div>
                    <div class="card-body p-3">
                      <h6 class="card-title fw-bold mb-1 text-truncate" title="${u.title}">üé¨ ${u.title}</h6>
                      <p class="card-text small text-muted mb-0 text-truncate" title="${u.summary||""}">${u.summary||""}</p>
                    </div>
                  </div>
                </div>
              `:"").join(""):"";o.innerHTML=l?`<div class="row g-3">${l}</div>`:`<div class="p-2">No se encontraron resultados para "${c}"</div>`}catch(g){console.error("Error fetching search results:",g)}}e.addEventListener("click",i),t.addEventListener("keypress",r=>{r.key==="Enter"&&i(r)})}const W="https://cb-back-prueba.vercel.app/videos",q="https://cb-back-prueba.vercel.app/categories";let T=[],I=[],x=null;function O(e){const t=document.getElementById("workshopVideosGrid");if(!t)return;const o=["linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-pink) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-green) 0%, var(--color-yellow) 100%)","linear-gradient(135deg, var(--color-yellow) 0%, var(--color-orange) 100%)","linear-gradient(135deg, var(--color-orange) 0%, var(--color-primary) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-yellow) 100%)"],s=(e||[]).map((n,i)=>{const r=(n.title||"Video").replace(/'/g,"\\'"),d=(n.url||"").replace(/'/g,"\\'");return`
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
            <div class="position-relative">
              <div class="ratio ratio-16x9" style="background: ${o[i%o.length]}; cursor: pointer; position: relative;"
                onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${n.id_video}, title: '${r}', url: '${d}' }));">
                <div class="play-button-container">
                  <i class="bi bi-play-circle-fill"></i>
                  <div class="play-text">Reproducir</div>
                </div>
              </div>
            </div>
            <div class="card-body p-3">
              <h6 class="card-title fw-bold mb-0 text-truncate" title="${n.title}">üé¨ ${n.title}</h6>
            </div>
          </div>
        </div>
      `}).join("");t.innerHTML=s||'<div class="text-muted">No hay videos para mostrar.</div>'}function J(e){const t=T.find(s=>(s.category_name||"").toLowerCase()===(e||"").toLowerCase());x=t?t.id_category:null;const o=x?I.filter(s=>s.id_category===x):I;O(o)}async function F(){console.log("üèãÔ∏è Workshop.js cargado correctamente.");try{const[e,t]=await Promise.all([w(q),w(W)]);Array.isArray(e)?T=e:T=[],Array.isArray(t)?I=t:I=[],O(I)}catch(e){console.error("Error cargando categor√≠as/videos:",e)}document.addEventListener("click",e=>{const t=e.target.closest(".category-chip");if(!t)return;const o=t.getAttribute("data-category")||t.textContent?.trim();o&&(document.querySelectorAll(".category-chip.active").forEach(s=>s.classList.remove("active")),t.classList.add("active"),J(o))},{passive:!0})}function G(){try{const e=localStorage.getItem("currentVideo"),t=e?JSON.parse(e):null,o=document.querySelector(".video-placeholder"),s=document.getElementById("videoTitle");if(!o||!s){console.warn("Elementos del reproductor no encontrados.");return}if(!t?.url)return;const n=document.createElement("video");n.src=t.url,n.controls=!0,n.className="w-100",n.style.borderRadius="0",n.style.display="block",n.addEventListener("loadedmetadata",function(){const r=n.videoWidth,d=n.videoHeight,c=800,g=r/d;let l=r;if(l>c&&(l=c),Math.abs(l-720)>50){const y=document.querySelector(".video-container"),E=document.querySelector(".video-info-container"),v=document.querySelector(".comments-section");y&&(y.style.width=l+"px"),E&&(E.style.width=l+"px"),v&&(v.style.width=l+"px")}});const i=o.parentNode;i?i.replaceChild(n,o):(o.className="",o.style.cssText="",o.innerHTML="",o.appendChild(n)),s.textContent=t.title||"Video seleccionado"}catch(e){console.error("Error inicializando el reproductor:",e)}}const k="https://cb-back-prueba.vercel.app";function _(){const e=document.getElementById("uploadPanel"),t=document.getElementById("uploadVideoForm"),o=document.getElementById("category"),s=document.getElementById("user"),n=document.getElementById("closeUploadPanel"),i=document.getElementById("videoFile"),r=document.getElementById("thumbnailPreviewSection"),d=document.getElementById("thumbnailPreview"),c=document.getElementById("submitBtn"),g=document.getElementById("submitBtnText");if(!e||!t)return;e.classList.remove("show"),console.log("üîÑ Inicializando panel de upload con preview de miniatura..."),E(),v();function l(a){if(!a||!a.type.startsWith("video/")){r.style.display="none";return}const m=URL.createObjectURL(a),p=document.createElement("video");p.muted=!0,p.crossOrigin="anonymous",p.addEventListener("loadedmetadata",function(){const h=this.duration*.25;this.currentTime=h}),p.addEventListener("seeked",function(){const h=document.createElement("canvas"),L=h.getContext("2d");h.width=this.videoWidth,h.height=this.videoHeight,L.drawImage(this,0,0,h.width,h.height);const b=h.toDataURL("image/jpeg",.8);d.innerHTML=`
        <img src="${b}" alt="Video Thumbnail Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
        <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem;">
          ${Math.round(this.duration)}s
        </div>
      `,r.style.display="block",URL.revokeObjectURL(m)}),p.addEventListener("error",function(){console.error("Error al cargar video para preview"),r.style.display="none"}),p.src=m}i.addEventListener("change",a=>{const m=a.target.files[0];m?(console.log("üé¨ Archivo de video seleccionado:",m.name),l(m)):r.style.display="none"});function u(){e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show")}n?.addEventListener("click",()=>{e.classList.remove("show"),t.reset(),r.style.display="none",d.innerHTML=`
      <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
      <span class="text-muted">Preview will appear here</span>
    `}),document.addEventListener("click",a=>{e.classList.contains("show")&&!e.contains(a.target)&&!a.target.closest("#buttonupload")&&(e.classList.remove("show"),t.reset(),r.style.display="none",d.innerHTML=`
        <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
        <span class="text-muted">Preview will appear here</span>
      `)});const y=document.getElementById("buttonupload");y&&y.addEventListener("click",a=>{a.preventDefault(),console.log("üîò Bot√≥n de upload clickeado"),u()}),t.addEventListener("submit",async a=>{a.preventDefault();try{c.disabled=!0,c.classList.add("loading"),g.textContent="‚è≥ Processing...";const m=document.getElementById("videoFile"),p=document.getElementById("title"),h=s?.value,L=o?.value;if(console.log("üìù Valores del formulario:",{userId:h,categoryId:L,title:p.value}),!h||!L){alert("Please select both a category and a speaker");return}const b=new FormData;b.append("file",m.files[0]),b.append("title",p.value),b.append("id_user",h),b.append("id_category",L),console.log("üöÄ Enviando video al backend...");const S=await fetch(`${k}/videos/create`,{method:"POST",body:b});if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const M=await S.json();console.log("‚úÖ Respuesta del backend:",M),e.classList.add("success"),g.textContent="‚úÖ Upload Complete!",setTimeout(()=>{t.reset(),e.classList.remove("show","success"),r.style.display="none",d.innerHTML=`
          <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
          <span class="text-muted">Preview will appear here</span>
        `,c.disabled=!1,c.classList.remove("loading"),g.textContent="Upload Video"},2e3)}catch(m){console.error("‚ùå Error durante el upload:",m),c.disabled=!1,c.classList.remove("loading"),g.textContent="Upload Video",alert("Error uploading video. Please try again.")}});async function E(){try{console.log("üîÑ Cargando categor√≠as desde:",`${k}/categories`);const a=await w(`${k}/categories`);if(console.log("üìä Categor√≠as recibidas:",a),!o){console.error("‚ùå Elemento selectCategory no encontrado");return}o.innerHTML='<option value="">Select a category...</option>',Array.isArray(a)?(a.forEach(m=>{const p=document.createElement("option");p.value=m.id_category,p.textContent=m.category_name,o.appendChild(p)}),console.log("‚úÖ Select de categor√≠as poblado con",a.length,"opciones")):console.error("‚ùå Las categor√≠as no son un array:",a)}catch(a){console.error("‚ùå Error cargando categor√≠as:",a)}}async function v(){try{const a=await w(`${k}/speakers`);s.innerHTML='<option value="">Choose a speaker...</option>',a.forEach(m=>{const p=document.createElement("option");p.value=m.id_user,p.textContent=m.nickname,s.appendChild(p)}),console.log("‚úÖ Speakers cargados:",a.length)}catch(a){console.error("‚ùå Error cargando speakers:",a),s.innerHTML='<option value="">Error loading speakers</option>'}}console.log("‚úÖ Sistema de upload con preview de miniatura inicializado completamente")}document.addEventListener("DOMContentLoaded",()=>{console.log("üöÄ DOM cargado, inicializando upload..."),_()});const K=["/home","/videos","/workshop"];async function f(e){console.log("Router: navigate() called with path:",e);const t=document.getElementById("app-content"),o=C[e]||C["/"];try{const s=JSON.parse(localStorage.getItem("user"));if(K.includes(e)&&!s)return console.warn("Access denied. Redirecting to /login..."),f("/login");window.location.pathname!==e&&window.history.pushState({},"",e);const n=await fetch(o);if(!n.ok)throw new Error(`Could not load page: ${o}`);const i=await n.text();t.innerHTML=i,Q(e),X(e),console.log(`Navigation completed: ${e}`)}catch(s){console.error("Navigation error:",s),t.innerHTML=`<h1>Error</h1><p>${s.message}</p>`}}function Q(e){const t=document.getElementById("sidebar"),o=document.getElementById("main-content"),s=document.getElementById("app-content");e==="/"||e==="/login"?(t?.classList.add("hidden"),o?.classList.add("full-width"),s?.classList.add("login-fullscreen")):(t?.classList.remove("hidden"),o?.classList.remove("full-width"),s?.classList.remove("login-fullscreen"))}function X(e){switch(e){case"/":case"/login":console.log("Initializing LoginUser..."),N();break;case"/home":console.log("Initializing Home..."),z();break;case"/uploadVideos":console.log("Initializing Home..."),_();break;case"/videos":console.log("Initializing Videos..."),setTimeout(()=>{G(),$(()=>import("./main-Co5CF4Nt.js"),[],import.meta.url).then(t=>{t.initComments()}),$(()=>import("./chat-_b2OuGUo.js"),[],import.meta.url).then(t=>{t.initChat()})},100);break;case"/workshop":console.log("Initializing Workshop..."),setTimeout(()=>F(),0);break;default:console.log("No script defined for this route.")}}document.addEventListener("DOMContentLoaded",async()=>{const e=JSON.parse(localStorage.getItem("user")),t=window.location.pathname;if((t==="/"||t==="/login")&&e)return console.log("User detected, redirecting to /home"),f("/home");f(t)});window.addEventListener("popstate",()=>{f(window.location.pathname)});window.navigateTo=f;function Y(){const e=document.getElementById("mobileMenuBtn"),t=document.getElementById("sidebar"),o=document.getElementById("sidebarOverlay"),s=document.querySelector(".hamburger");if(!e||!t||!o||!s){console.warn("Mobile menu elements not found");return}function n(){t.classList.contains("mobile-open")?r():i()}function i(){t.classList.add("mobile-open"),o.classList.add("active"),s.classList.add("active"),document.body.style.overflow="hidden"}function r(){t.classList.remove("mobile-open"),o.classList.remove("active"),s.classList.remove("active"),document.body.style.overflow=""}e.addEventListener("click",n),o.addEventListener("click",r),t.querySelectorAll(".nav-item").forEach(c=>{c.addEventListener("click",()=>{setTimeout(r,100)})}),document.addEventListener("keydown",c=>{c.key==="Escape"&&r()}),window.addEventListener("resize",()=>{window.innerWidth>768&&r()}),console.log("üì± Mobile menu initialized")}document.addEventListener("DOMContentLoaded",function(){f("/"),Y()});window.handleUpload=function(){f("/uploadVideos")};export{ee as d,w as g,U as p,Z as u};
