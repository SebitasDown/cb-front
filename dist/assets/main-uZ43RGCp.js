(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const N="modulepreload",V=function(e,t){return new URL(e,t).href},$={},C=function(t,o,i){let r=Promise.resolve();if(o&&o.length>0){let u=function(d){return Promise.all(d.map(g=>Promise.resolve(g).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const n=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");r=u(o.map(d=>{if(d=V(d,i),d in $)return;$[d]=!0;const g=d.endsWith(".css"),h=g?'[rel="stylesheet"]':"";if(!!i)for(let l=n.length-1;l>=0;l--){const m=n[l];if(m.href===d&&(!g||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${h}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":N,g||(v.as="script"),v.crossOrigin="",v.href=d,a&&v.setAttribute("nonce",a),document.head.appendChild(v),g)return new Promise((l,m)=>{v.addEventListener("load",l),v.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${d}`)))})}))}function c(n){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=n,window.dispatchEvent(s),!s.defaultPrevented)throw n}return r.then(n=>{for(const s of n||[])s.status==="rejected"&&c(s.reason);return t().catch(c)})},B={"/":"./views/login.html","/login":"./views/login.html","/home":"./views/home.html","/uploadVideos":"./views/videos.html","/videos":"./views/videoplayer.html","/workshop":"./views/workshop.html"};async function L(e){try{return await(await fetch(e)).json()}catch(t){console.error("Error en GET:",t)}}async function R(e,t){try{return await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}catch(o){console.error("Error en POST:",o)}}async function Z(e,t){try{const i=await(await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return console.log("PUT actualizado:",i),i}catch(o){throw console.error("Error en PUT:",o),o}}async function ee(e){try{return(await fetch(e,{method:"DELETE"})).ok?(console.log("DELETE: recurso eliminado correctamente"),!0):(console.error("Error al eliminar"),!1)}catch(t){throw console.error("Error en DELETE:",t),t}}const A="https://cb-back-prueba.vercel.app/auth";function H(){const e=document.getElementById("login-form"),t=document.getElementById("logout-btn"),o=JSON.parse(localStorage.getItem("user"));o&&(console.log(`Active session: ${o.email}`),b("/home")),e&&e.addEventListener("submit",async i=>{i.preventDefault();const r=document.getElementById("email").value,c=document.getElementById("password").value;try{const n=await R(A,{email:r,user_password:c});n.user?(localStorage.setItem("user",JSON.stringify(n.user)),console.log(`Login successful. Welcome, ${n.user.email}`),b("/home")):console.log(`Login failed: ${n.message||"Invalid credentials"}`)}catch(n){console.error("Error during login:",n)}}),t&&t.addEventListener("click",()=>{localStorage.removeItem("user"),console.log("Session closed."),b("/login")})}const U="https://cb-back-prueba.vercel.app/search",D="https://cb-back-prueba.vercel.app/videos";async function W(){try{const e=await L(D);if(!Array.isArray(e))return;const o=e.sort((n,s)=>new Date(s.video_date)-new Date(n.video_date)).slice(0,3),i=document.getElementById("recentWorkshopsGrid");if(!i)return;const r=["linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-pink) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-green) 0%, var(--color-yellow) 100%)","linear-gradient(135deg, var(--color-yellow) 0%, var(--color-orange) 100%)","linear-gradient(135deg, var(--color-orange) 0%, var(--color-primary) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-yellow) 100%)"],c=o.map((n,s)=>n?.url?`
          <div class="col-12 col-sm-6 col-md-4">
            <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
              <div class="position-relative">
                <div class="ratio ratio-16x9" style="background: ${r[s%r.length]}; cursor: pointer; position: relative;"
                  onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${n.id_video||1}, title: '${n.title?.replace(/'/g,"\\'")}', url: '${n.url?.replace(/'/g,"\\'")}' }));">
                  <div class="play-button-container">
                    <i class="bi bi-play-circle-fill"></i>
                  </div>
                </div>
                <span class="position-absolute top-0 start-0 m-2 badge bg-success">üÜï</span>
              </div>
              <div class="card-body p-3">
                <h6 class="card-title fw-bold mb-1 text-truncate" title="${n.title}">üé¨ ${n.title}</h6>
                <p class="card-text small text-muted mb-0 text-truncate" title="${n.summary||""}">${n.summary||""}</p>
              </div>
            </div>
          </div>
        `:"").join("");i.innerHTML=c}catch(e){console.error("Error loading recent workshops:",e)}}function q(){const e=document.getElementById("searchbtn"),t=document.getElementById("searchInput"),o=document.getElementById("searchResults"),i=document.querySelector(".view-container");W(),r();async function r(){try{const s=localStorage.getItem("user");if(s){const a=JSON.parse(s),u=document.querySelector(".welcome-section h2");if(u){if(a.nickname)u.innerHTML=`Welcome back, ${a.nickname}! üëã`;else if(a.name)u.innerHTML=`Welcome back, ${a.name}! üëã`;else if(a.email){const d=a.email.split("@")[0];u.innerHTML=`Welcome back, ${d}! üëã`}}}else{const a=document.querySelector(".welcome-section h2");a&&(a.innerHTML="Welcome back, Coder! üëã")}}catch(s){console.error("Error updating welcome message:",s);const a=document.querySelector(".welcome-section h2");a&&(a.innerHTML="Welcome back, Coder! üëã")}}function c(s){if(!i)return;Array.from(i.children).forEach(u=>{const d=u.classList?.contains("welcome-section"),g=u.id==="searchResults";d||g||(u.style.display=s?"":"none")})}async function n(s){s.preventDefault();const u=document.getElementById("searchInput").value.trim();if(!u){c(!0),o&&(o.innerHTML="");return}try{c(!1);const d=await L(`${U}?q=${encodeURIComponent(u)}`);if(!Array.isArray(d)||d.length===0){o.innerHTML=`<div class="p-2">No se encontraron resultados para "${u}"</div>`;return}const g=["linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-pink) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-green) 0%, var(--color-yellow) 100%)","linear-gradient(135deg, var(--color-yellow) 0%, var(--color-orange) 100%)","linear-gradient(135deg, var(--color-orange) 0%, var(--color-primary) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-yellow) 100%)"],h=Array.isArray(d)?d.map((y,v)=>y?.url?`
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                  <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
                    <div class="position-relative">
                      <div class="ratio ratio-16x9" style="background: ${g[v%g.length]}; cursor: pointer; position: relative;"
                        onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${y.id_video||1}, title: '${y.title?.replace(/'/g,"\\'")}', url: '${y.url?.replace(/'/g,"\\'")}' }));">
                        <div class="play-button-container">
                          <i class="bi bi-play-circle-fill"></i>
                        </div>
                      </div>
                      <span class="position-absolute top-0 start-0 m-2 badge bg-primary">‚ñ∂Ô∏è</span>
                    </div>
                    <div class="card-body p-3">
                      <h6 class="card-title fw-bold mb-1 text-truncate" title="${y.title}">üé¨ ${y.title}</h6>
                      <p class="card-text small text-muted mb-0 text-truncate" title="${y.summary||""}">${y.summary||""}</p>
                    </div>
                  </div>
                </div>
              `:"").join(""):"";o.innerHTML=h?`<div class="row g-3">${h}</div>`:`<div class="p-2">No se encontraron resultados para "${u}"</div>`}catch(d){console.error("Error fetching search results:",d)}}e.addEventListener("click",n),t.addEventListener("keypress",s=>{s.key==="Enter"&&n(s)})}const j="https://cb-back-prueba.vercel.app/videos",z="https://cb-back-prueba.vercel.app/categories";let x=[],E=[],S=null;function M(e){const t=document.getElementById("workshopVideosGrid");if(!t)return;const o=["linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-pink) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-green) 0%, var(--color-yellow) 100%)","linear-gradient(135deg, var(--color-yellow) 0%, var(--color-orange) 100%)","linear-gradient(135deg, var(--color-orange) 0%, var(--color-primary) 100%)","linear-gradient(135deg, var(--color-accent) 0%, var(--color-green) 100%)","linear-gradient(135deg, var(--color-pink) 0%, var(--color-yellow) 100%)"],i=(e||[]).map((r,c)=>{const n=(r.title||"Video").replace(/'/g,"\\'"),s=(r.url||"").replace(/'/g,"\\'");return`
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm border-0 overflow-hidden" style="border-radius: 12px;">
            <div class="position-relative">
              <div class="ratio ratio-16x9" style="background: ${o[c%o.length]}; cursor: pointer; position: relative;"
                onclick="navigateTo('/videos'); localStorage.setItem('currentVideo', JSON.stringify({ id_video: ${r.id_video}, title: '${n}', url: '${s}' }));">
                <div class="play-button-container">
                  <i class="bi bi-play-circle-fill"></i>
                </div>
              </div>
              <!-- Bot√≥n de eliminar -->
              <button class="btn btn-delete-video" onclick="deleteVideo(${r.id_video}, this)" title="Eliminar video">
                <i class="bi bi-trash-fill"></i>
              </button>
            </div>
            <div class="card-body p-3">
              <h6 class="card-title fw-bold mb-0 text-truncate" title="${r.title}">üé¨ ${r.title}</h6>
            </div>
          </div>
        </div>
      `}).join("");t.innerHTML=i||'<div class="text-muted">No hay videos para mostrar.</div>'}function J(e){const t=x.find(i=>(i.category_name||"").toLowerCase()===(e||"").toLowerCase());S=t?t.id_category:null;const o=S?E.filter(i=>i.id_category===S):E;M(o)}window.deleteVideo=async function(e,t){if(confirm("¬øEst√°s seguro de que quieres eliminar este video?"))try{if((await fetch(`https://cb-back-prueba.vercel.app/videos/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok){E=E.filter(r=>r.id_video!==e);const i=t.closest(".col-12");i&&i.remove(),P("Video eliminado correctamente","success")}else throw new Error("Error al eliminar el video")}catch(o){console.error("Error eliminando video:",o),P("Error al eliminar el video","error")}};function P(e,t="info"){const o=document.createElement("div");o.className=`alert alert-${t==="success"?"success":"danger"} position-fixed`,o.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",o.innerHTML=e,document.body.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},3e3)}async function F(){console.log("üèãÔ∏è Workshop.js cargado correctamente.");try{const[e,t]=await Promise.all([L(z),L(j)]);Array.isArray(e)?x=e:x=[],Array.isArray(t)?E=t:E=[],M(E)}catch(e){console.error("Error cargando categor√≠as/videos:",e)}document.addEventListener("click",e=>{const t=e.target.closest(".category-chip");if(!t)return;const o=t.getAttribute("data-category")||t.textContent?.trim();o&&(document.querySelectorAll(".category-chip.active").forEach(i=>i.classList.remove("active")),t.classList.add("active"),J(o))},{passive:!0})}function G(){try{const e=localStorage.getItem("currentVideo"),t=e?JSON.parse(e):null,o=document.querySelector(".video-placeholder"),i=document.getElementById("videoTitle");if(!o||!i){console.warn("Elementos del reproductor no encontrados.");return}if(!t?.url)return;const r=document.createElement("video");r.src=t.url,r.controls=!0,r.className="w-100",r.style.borderRadius="0",r.style.display="block",r.addEventListener("loadedmetadata",function(){const n=r.videoWidth,s=r.videoHeight,a=800,u=n/s;let d=n;if(d>a&&(d=a),Math.abs(d-720)>50){const h=document.querySelector(".video-container"),y=document.querySelector(".video-info-container"),v=document.querySelector(".comments-section");h&&(h.style.width=d+"px"),y&&(y.style.width=d+"px"),v&&(v.style.width=d+"px")}});const c=o.parentNode;c?c.replaceChild(r,o):(o.className="",o.style.cssText="",o.innerHTML="",o.appendChild(r)),i.textContent=t.title||"Video seleccionado"}catch(e){console.error("Error inicializando el reproductor:",e)}}const I="https://cb-back-prueba.vercel.app";function O(){const e=document.getElementById("uploadPanel"),t=document.getElementById("uploadVideoForm"),o=document.getElementById("category"),i=document.getElementById("user"),r=document.getElementById("closeUploadPanel"),c=document.getElementById("videoFile"),n=document.getElementById("thumbnailPreviewSection"),s=document.getElementById("thumbnailPreview"),a=document.getElementById("submitBtn"),u=document.getElementById("submitBtnText");if(!e||!t)return;e.classList.remove("show"),console.log("üîÑ Inicializando panel de upload con preview de miniatura..."),y(),v();function d(l){if(!l||!l.type.startsWith("video/")){n.style.display="none";return}const m=URL.createObjectURL(l),p=document.createElement("video");p.muted=!0,p.crossOrigin="anonymous",p.addEventListener("loadedmetadata",function(){const f=this.duration*.25;this.currentTime=f}),p.addEventListener("seeked",function(){const f=document.createElement("canvas"),k=f.getContext("2d");f.width=this.videoWidth,f.height=this.videoHeight,k.drawImage(this,0,0,f.width,f.height);const w=f.toDataURL("image/jpeg",.8);s.innerHTML=`
        <img src="${w}" alt="Video Thumbnail Preview" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
        <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem;">
          ${Math.round(this.duration)}s
        </div>
      `,n.style.display="block",URL.revokeObjectURL(m)}),p.addEventListener("error",function(){console.error("Error al cargar video para preview"),n.style.display="none"}),p.src=m}c.addEventListener("change",l=>{const m=l.target.files[0];m?(console.log("üé¨ Archivo de video seleccionado:",m.name),d(m)):n.style.display="none"});function g(){e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show")}r?.addEventListener("click",()=>{e.classList.remove("show"),t.reset(),n.style.display="none",s.innerHTML=`
      <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
      <span class="text-muted">Preview will appear here</span>
    `}),document.addEventListener("click",l=>{e.classList.contains("show")&&!e.contains(l.target)&&!l.target.closest("#buttonupload")&&(e.classList.remove("show"),t.reset(),n.style.display="none",s.innerHTML=`
        <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
        <span class="text-muted">Preview will appear here</span>
      `)});const h=document.getElementById("buttonupload");h&&h.addEventListener("click",l=>{l.preventDefault(),console.log("üîò Bot√≥n de upload clickeado"),g()}),t.addEventListener("submit",async l=>{l.preventDefault();try{a.disabled=!0,a.classList.add("loading"),u.textContent="‚è≥ Processing...";const m=document.getElementById("videoFile"),p=document.getElementById("title"),f=i?.value,k=o?.value;if(console.log("üìù Valores del formulario:",{userId:f,categoryId:k,title:p.value}),!f||!k){alert("Please select both a category and a speaker");return}const w=new FormData;w.append("file",m.files[0]),w.append("title",p.value),w.append("id_user",f),w.append("id_category",k),console.log("üöÄ Enviando video al backend...");const T=await fetch(`${I}/videos/create`,{method:"POST",body:w});if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);const _=await T.json();console.log("‚úÖ Respuesta del backend:",_),e.classList.add("success"),u.textContent="‚úÖ Upload Complete!",setTimeout(()=>{t.reset(),e.classList.remove("show","success"),n.style.display="none",s.innerHTML=`
          <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
          <span class="text-muted">Preview will appear here</span>
        `,a.disabled=!1,a.classList.remove("loading"),u.textContent="Upload Video"},2e3)}catch(m){console.error("‚ùå Error durante el upload:",m),a.disabled=!1,a.classList.remove("loading"),u.textContent="Upload Video",alert("Error uploading video. Please try again.")}});async function y(){try{console.log("üîÑ Cargando categor√≠as desde:",`${I}/categories`);const l=await L(`${I}/categories`);if(console.log("üìä Categor√≠as recibidas:",l),!o){console.error("‚ùå Elemento selectCategory no encontrado");return}o.innerHTML='<option value="">Select a category...</option>',Array.isArray(l)?(l.forEach(m=>{const p=document.createElement("option");p.value=m.id_category,p.textContent=m.category_name,o.appendChild(p)}),console.log("‚úÖ Select de categor√≠as poblado con",l.length,"opciones")):console.error("‚ùå Las categor√≠as no son un array:",l)}catch(l){console.error("‚ùå Error cargando categor√≠as:",l)}}async function v(){try{const l=await L(`${I}/speakers`);i.innerHTML='<option value="">Choose a speaker...</option>',l.forEach(m=>{const p=document.createElement("option");p.value=m.id_user,p.textContent=m.nickname,i.appendChild(p)}),console.log("‚úÖ Speakers cargados:",l.length)}catch(l){console.error("‚ùå Error cargando speakers:",l),i.innerHTML='<option value="">Error loading speakers</option>'}}console.log("‚úÖ Sistema de upload con preview de miniatura inicializado completamente")}document.addEventListener("DOMContentLoaded",()=>{console.log("üöÄ DOM cargado, inicializando upload..."),O()});const K=["/home","/videos","/workshop"];async function b(e){console.log("Router: navigate() called with path:",e);const t=document.getElementById("app-content"),o=B[e]||B["/"];try{const i=JSON.parse(localStorage.getItem("user"));if(K.includes(e)&&!i)return console.warn("Access denied. Redirecting to /login..."),b("/login");window.location.pathname!==e&&window.history.pushState({},"",e);const r=await fetch(o);if(!r.ok)throw new Error(`Could not load page: ${o}`);const c=await r.text();t.innerHTML=c,Q(e),X(e),console.log(`Navigation completed: ${e}`)}catch(i){console.error("Navigation error:",i),t.innerHTML=`<h1>Error</h1><p>${i.message}</p>`}}function Q(e){const t=document.getElementById("sidebar"),o=document.getElementById("main-content"),i=document.getElementById("app-content");e==="/"||e==="/login"?(t?.classList.add("hidden"),o?.classList.add("full-width"),i?.classList.add("login-fullscreen")):(t?.classList.remove("hidden"),o?.classList.remove("full-width"),i?.classList.remove("login-fullscreen"))}function X(e){switch(e){case"/":case"/login":console.log("Initializing LoginUser..."),H();break;case"/home":console.log("Initializing Home..."),q();break;case"/uploadVideos":console.log("Initializing Home..."),O();break;case"/videos":console.log("Initializing Videos..."),setTimeout(()=>{G(),C(()=>import("./main-B1GRJoKm.js"),[],import.meta.url).then(t=>{t.initComments()}),C(()=>import("./chat-Dg4U7Ext.js"),[],import.meta.url).then(t=>{t.initChat()})},100);break;case"/workshop":console.log("Initializing Workshop..."),setTimeout(()=>F(),0);break;default:console.log("No script defined for this route.")}}document.addEventListener("DOMContentLoaded",async()=>{const e=JSON.parse(localStorage.getItem("user")),t=window.location.pathname;if((t==="/"||t==="/login")&&e)return console.log("User detected, redirecting to /home"),b("/home");b(t)});window.addEventListener("popstate",()=>{b(window.location.pathname)});window.navigateTo=b;function Y(){const e=document.getElementById("mobileMenuBtn"),t=document.getElementById("sidebar"),o=document.getElementById("sidebarOverlay"),i=document.querySelector(".hamburger");if(!e||!t||!o||!i){console.warn("Mobile menu elements not found");return}function r(){t.classList.contains("mobile-open")?n():c()}function c(){t.classList.add("mobile-open"),o.classList.add("active"),i.classList.add("active"),document.body.style.overflow="hidden"}function n(){t.classList.remove("mobile-open"),o.classList.remove("active"),i.classList.remove("active"),document.body.style.overflow=""}e.addEventListener("click",r),o.addEventListener("click",n),t.querySelectorAll(".nav-item").forEach(a=>{a.addEventListener("click",()=>{setTimeout(n,100)})}),document.addEventListener("keydown",a=>{a.key==="Escape"&&n()}),window.addEventListener("resize",()=>{window.innerWidth>768&&n()}),console.log("üì± Mobile menu initialized")}document.addEventListener("DOMContentLoaded",function(){b("/"),Y()});window.handleUpload=function(){b("/uploadVideos")};export{ee as d,L as g,R as p,Z as u};
